<h1 class="text-3xl font-bold mb-6"><%= @community.name %></h1>

<% if traveler_signed_in? %>
  <!-- Provider Category Tabs -->
  <nav class="mb-6 flex gap-4 border-b pb-2 text-sm font-medium text-gray-600">
    <% @all_categories.each_with_index do |category, index| %>
      <a href="javascript:void(0);"
         data-category="<%= category.downcase %>"
         class="category-tab px-4 py-2 rounded transition <%= index == 0 ? 'bg-white text-blue-700 border-b-2 border-blue-700' : 'hover:text-blue-600' %>">
        <%= category.titleize %>
      </a>
    <% end %>
  </nav>

  <!-- Provider Sections (same structure as before) -->
  <% @all_categories.each_with_index do |category, index| %>
    <% providers = @grouped_providers[category] || [] %>
    <section id="<%= category.downcase %>-section"
             class="<%= index == 0 ? '' : 'hidden' %> category-section mb-10">
      <h2 class="text-2xl font-semibold mb-4 text-gray-800"><%= category %></h2>
      <% if providers.any? %>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
          <% providers.each do |provider| %>
            <!-- Provider Card -->
          <% end %>
        </div>
      <% else %>
        <p class="text-sm text-gray-500">No providers listed under <%= category %>.</p>
      <% end %>
    </section>
  <% end %>

<% else %>
  <!-- Guest Prompt -->
  <div class="text-center mt-6">
    <button id="access-details-btn"
            class="bg-blue-600 text-white px-6 py-3 rounded hover:bg-blue-700 transition">
      Access Community Details
    </button>
  </div>

  <!-- Modal -->
<div id="login-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white rounded-lg shadow-lg p-6 max-w-md w-full">
    <h2 class="text-xl font-semibold mb-4">Login Required</h2>
    <p class="mb-4">Please sign up or log in to view full community details.</p>
    <div class="flex justify-end gap-4">
      <a href="<%= new_traveler_registration_path(redirect_to: request.fullpath) %>"
         class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition">
        Sign Up
      </a>
      <a href="<%= new_traveler_session_path(redirect_to: request.fullpath) %>"
         class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">
        Log In
      </a>
      <button id="close-modal"
              class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition">
        Cancel
      </button>
    </div>
  </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
      const modal = document.getElementById("login-modal");
      const openBtn = document.getElementById("access-details-btn");
      const closeBtn = document.getElementById("close-modal");

      openBtn.addEventListener("click", () => modal.classList.remove("hidden"));
      closeBtn.addEventListener("click", () => modal.classList.add("hidden"));
    });
  </script>
<% end %>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const tabs = document.querySelectorAll(".category-tab");
    const sections = document.querySelectorAll(".category-section");

    tabs.forEach(tab => {
      tab.addEventListener("click", () => {
        const selected = tab.dataset.category;

        // Toggle active tab styling
        tabs.forEach(t => t.classList.remove("bg-white", "text-blue-700", "border-b-2", "border-blue-700"));
        tab.classList.add("bg-white", "text-blue-700", "border-b-2", "border-blue-700");

        // Show only the selected section
        sections.forEach(section => {
          if (section.id === `${selected}-section`) {
            section.classList.remove("hidden");
          } else {
            section.classList.add("hidden");
          }
        });
      });
    });
  });
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const loginButton = document.getElementById("login-prompt-button");
    const loginModal = document.getElementById("login-modal");
    const closeModal = document.getElementById("close-modal");

    if (loginButton && loginModal && closeModal) {
      loginButton.addEventListener("click", () => {
        loginModal.classList.remove("hidden");
      });

      closeModal.addEventListener("click", () => {
        loginModal.classList.add("hidden");
      });

      // Optional: close modal if clicking outside the box
      loginModal.addEventListener("click", (e) => {
        if (e.target === loginModal) loginModal.classList.add("hidden");
      });
    }
  });
</script>